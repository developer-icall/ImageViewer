# translate_json フォルダ仕様

## 概要

`imageviewer/static/translate_json` フォルダには、AI画像生成時に使用された英語のプロンプトを日本語に変換するための対応表が格納されています。これらのJSONファイルは、画像詳細表示時にプロンプト情報を日本語で表示するために使用されます。

## ファイル構造

各JSONファイルは、特定のプロンプトカテゴリ（ポーズ、髪の色、衣服など）に対応しており、ファイル名はそのカテゴリ名と一致します。例えば：

- `pose.json` - ポーズに関連するプロンプトの翻訳
- `Hair Color.json` - 髪の色に関連するプロンプトの翻訳
- `Cloth.json` - 衣服に関連するプロンプトの翻訳
- `Face.json` - 顔の特徴に関連するプロンプトの翻訳
- `Women Type.json` - 女性のタイプに関連するプロンプトの翻訳
- `Place.json` - 場所に関連するプロンプトの翻訳
- `age.json` - 年齢に関連するプロンプトの翻訳
- `Accesarry.json` - アクセサリーに関連するプロンプトの翻訳
- `Hair Type.json` - 髪型に関連するプロンプトの翻訳
- など

## JSONファイルの形式

各JSONファイルは、キーと値のペアで構成されています：

```json
{
    "英語のプロンプト": "日本語の翻訳",
    "英語のプロンプト2": "日本語の翻訳2",
    ...
}
```

例えば、`pose.json` の一部：

```json
{
    "(Selfie with left hand: 1.4)": "左手でセルフィー",
    "(Selfie with right hand: 1.4)": "右手で自撮り",
    "Seductive pose": "魅惑的なポーズ",
    "tilting head": "首を傾げる"
}
```

## 翻訳処理の仕組み

1. 画像生成時に作成されたJSONファイル（例：`00000-1234567890.json`）には、英語のプロンプト情報が含まれています。
2. ユーザーが画像詳細を表示する際、アプリケーションは以下の処理を行います：
   - JSONファイルからプロンプト情報を読み取る
   - プロンプトのカテゴリ（例：`pose`、`Hair Color`など）に対応する翻訳用JSONファイルを読み込む
   - 英語のプロンプトを翻訳用JSONファイルのキーと照合し、一致するものがあれば日本語の翻訳に置き換える
   - 翻訳結果を画面に表示する

## 翻訳処理の詳細

翻訳処理は `app.py` の `translate_prompt()` および `translate_text()` 関数で行われます：

1. `translate_prompt()` 関数：
   - プロンプトカテゴリ名（例：`pose`）に対応する翻訳用JSONファイルを読み込む
   - プロンプトを小文字に変換して `translate_text()` 関数に渡す

2. `translate_text()` 関数：
   - 翻訳対象の文字列と翻訳対応表を受け取る
   - 翻訳対応表のキーと一致する部分を見つけ、対応する日本語に置き換える
   - 置き換えた部分を `[]` で囲む
   - `[]` で囲まれた部分を抽出して連結し、最終的な翻訳結果を返す

## 新しい翻訳の追加方法

新しいプロンプトとその翻訳を追加するには：

1. 対応するカテゴリのJSONファイルを開く（または新しいカテゴリの場合は新規作成）
2. 新しいキーと値のペアを追加：
   ```json
   "新しい英語のプロンプト": "新しい日本語の翻訳"
   ```
3. ファイルを保存する

## 注意事項

- JSONファイルの形式が正しくない場合、翻訳処理が失敗する可能性があります
- 大文字と小文字は区別されません（翻訳処理前に小文字に変換されます）
- 翻訳対応表に存在しないプロンプトは翻訳されず、元の英語のまま表示されます
- 翻訳用JSONファイルが存在しないカテゴリのプロンプトも翻訳されません